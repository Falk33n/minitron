2024-05-10 09:36:20.160 +02:00 [INF] User profile is available. Using 'C:\Users\Max Planstedt\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-10 09:36:22.035 +02:00 [INF] Executed DbCommand (107ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 09:36:22.059 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-05-10 09:36:22.090 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 09:36:22.108 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 09:36:22.110 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-05-10 09:36:22.128 +02:00 [INF] No migrations were applied. The database is already up to date.
2024-05-10 09:36:22.370 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "AspNetRoles" AS a)
2024-05-10 09:36:22.783 +02:00 [INF] Now listening on: http://localhost:5248
2024-05-10 09:36:22.785 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-10 09:36:22.786 +02:00 [INF] Hosting environment: Development
2024-05-10 09:36:22.786 +02:00 [INF] Content root path: D:\ReposD\minitron\minitronapi
2024-05-10 09:36:23.222 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:36:23.362 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 141.368ms
2024-05-10 09:36:23.400 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:36:23.402 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 2.5461ms
2024-05-10 09:36:23.715 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:36:23.805 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 90.2581ms
2024-05-10 09:36:47.124 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Auth/login - application/json 68
2024-05-10 09:36:47.127 +02:00 [WRN] Failed to determine the https port for redirect.
2024-05-10 09:36:47.953 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.AuthController.Login (minitronapi)'
2024-05-10 09:36:47.970 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(minitronapi.DTOs.LoginUserModel) on controller minitronapi.Controllers.AuthController (minitronapi).
2024-05-10 09:36:48.095 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__normalizedEmail_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."NormalizedEmail" = @__normalizedEmail_0
LIMIT 2
2024-05-10 09:36:48.326 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a0."Name"
FROM "AspNetUserRoles" AS a
INNER JOIN "AspNetRoles" AS a0 ON a."RoleId" = a0."Id"
WHERE a."UserId" = @__userId_0
2024-05-10 09:36:48.378 +02:00 [INF] User string@string.com logged in at "2024-05-10T07:36:48.3779962Z"
2024-05-10 09:36:48.383 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2024-05-10 09:36:48.389 +02:00 [INF] Executed action minitronapi.Controllers.AuthController.Login (minitronapi) in 415.6295ms
2024-05-10 09:36:48.389 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.AuthController.Login (minitronapi)'
2024-05-10 09:36:48.396 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Auth/login - 200 null application/json; charset=utf-8 1271.3573ms
2024-05-10 09:37:07.469 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Auth/logout - null 0
2024-05-10 09:37:07.472 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.AuthController.Logout (minitronapi)'
2024-05-10 09:37:07.475 +02:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller minitronapi.Controllers.AuthController (minitronapi).
2024-05-10 09:37:07.495 +02:00 [INF] AuthenticationScheme: Identity.Application signed out.
2024-05-10 09:37:07.496 +02:00 [INF] User logged out at "2024-05-10T07:37:07.4874499Z"
2024-05-10 09:37:07.496 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2024-05-10 09:37:07.498 +02:00 [INF] Executed action minitronapi.Controllers.AuthController.Logout (minitronapi) in 22.0674ms
2024-05-10 09:37:07.498 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.AuthController.Logout (minitronapi)'
2024-05-10 09:37:07.498 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Auth/logout - 200 null application/json; charset=utf-8 29.1025ms
2024-05-10 09:37:34.817 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 118
2024-05-10 09:37:34.819 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:37:34.823 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:37:34.829 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 6.0665ms
2024-05-10 09:37:34.830 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:37:34.831 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: OpenAI API key is missing.
   at minitronapi.Services.RequestService..ctor(IHttpClientFactory httpClientFactory, IConfiguration configuration) in D:\ReposD\minitron\minitronapi\Services\RequestService.cs:line 24
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeDirectByRefWithFewArgs(Object obj, Span`1 copyOfArgs, BindingFlags invokeAttr)
   at System.Reflection.MethodBaseInvoker.InvokeWithFewArgs(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimeConstructorInfo.Invoke(BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method161(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:37:34.930 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 112.5045ms
2024-05-10 09:38:35.388 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:38:35.395 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 7.2957ms
2024-05-10 09:38:35.434 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:38:35.434 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.3961ms
2024-05-10 09:38:35.756 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:38:35.770 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 14.3403ms
2024-05-10 09:38:48.214 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 118
2024-05-10 09:38:48.215 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:38:48.219 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:38:48.230 +02:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'System.String'.
2024-05-10 09:38:48.231 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 11.7388ms
2024-05-10 09:38:48.231 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:38:48.231 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 401 null text/plain; charset=utf-8 16.9067ms
2024-05-10 09:39:09.125 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Auth/login - application/json 68
2024-05-10 09:39:09.126 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.AuthController.Login (minitronapi)'
2024-05-10 09:39:09.133 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(minitronapi.DTOs.LoginUserModel) on controller minitronapi.Controllers.AuthController (minitronapi).
2024-05-10 09:39:09.204 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__normalizedEmail_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."NormalizedEmail" = @__normalizedEmail_0
LIMIT 2
2024-05-10 09:39:09.293 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a0."Name"
FROM "AspNetUserRoles" AS a
INNER JOIN "AspNetRoles" AS a0 ON a."RoleId" = a0."Id"
WHERE a."UserId" = @__userId_0
2024-05-10 09:39:09.294 +02:00 [INF] User string@string.com logged in at "2024-05-10T07:39:09.2944347Z"
2024-05-10 09:39:09.294 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2024-05-10 09:39:09.295 +02:00 [INF] Executed action minitronapi.Controllers.AuthController.Login (minitronapi) in 161.8153ms
2024-05-10 09:39:09.295 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.AuthController.Login (minitronapi)'
2024-05-10 09:39:09.295 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Auth/login - 200 null application/json; charset=utf-8 169.9686ms
2024-05-10 09:39:14.725 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 118
2024-05-10 09:39:14.726 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:39:14.727 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:39:14.758 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."Id" = @__p_0
LIMIT 1
2024-05-10 09:39:15.203 +02:00 [INF] Start processing HTTP request POST http://192.168.90.99:5003/v1/chat/completions
2024-05-10 09:39:15.204 +02:00 [INF] Sending HTTP request POST http://192.168.90.99:5003/v1/chat/completions
2024-05-10 09:39:17.288 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 2561.3766ms
2024-05-10 09:39:17.289 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:39:17.290 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.Http.HttpRequestException: No connection could be made because the target machine actively refused it. (192.168.90.99:5003)
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at minitronapi.Services.RequestService.SendMessage(List`1 conversation)
   at minitronapi.Controllers.ChatController.SendMessage(SendMessageRequestModel request)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:39:17.318 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 2593.7395ms
2024-05-10 09:40:35.133 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:40:35.144 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 10.6189ms
2024-05-10 09:40:35.180 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:40:35.180 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.198ms
2024-05-10 09:40:35.464 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:40:35.470 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 6.6243ms
2024-05-10 09:40:48.001 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:40:48.009 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 7.694ms
2024-05-10 09:40:48.026 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:40:48.026 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.2427ms
2024-05-10 09:40:48.188 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:40:48.193 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 5.5785ms
2024-05-10 09:41:03.076 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 118
2024-05-10 09:41:03.077 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:41:03.082 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:41:03.091 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."Id" = @__p_0
LIMIT 1
2024-05-10 09:41:03.093 +02:00 [INF] Start processing HTTP request POST https://api.openai.com/v1/chat/completions
2024-05-10 09:41:03.093 +02:00 [INF] Sending HTTP request POST https://api.openai.com/v1/chat/completions
2024-05-10 09:41:04.379 +02:00 [INF] Received HTTP response headers after 1277.9026ms - 200
2024-05-10 09:41:04.380 +02:00 [INF] End processing HTTP request after 1286.7167ms - 200
2024-05-10 09:41:04.437 +02:00 [INF] API call duration: "00:00:01.3462447"
2024-05-10 09:41:04.561 +02:00 [ERR] Failed executing DbCommand (12ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?', @p4='?', @p5='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Requests" ("ConversationId", "CustomSystemPrompt", "Model", "Request", "RequestPrompt", "TimeStamp")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING "RequestId";
2024-05-10 09:41:04.572 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'minitronapi.Data.minitronContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-05-10 09:41:04.582 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 1499.5639ms
2024-05-10 09:41:04.582 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:41:04.583 +02:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at minitronapi.Services.ConversationService.SaveRequestToDatabase(RequestModel request)
   at minitronapi.Controllers.ChatController.SendMessage(SendMessageRequestModel request)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:41:04.598 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 1521.7802ms
2024-05-10 09:41:20.507 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 120
2024-05-10 09:41:20.510 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:41:20.510 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:41:20.525 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."Id" = @__p_0
LIMIT 1
2024-05-10 09:41:20.528 +02:00 [INF] Start processing HTTP request POST https://api.openai.com/v1/chat/completions
2024-05-10 09:41:20.528 +02:00 [INF] Sending HTTP request POST https://api.openai.com/v1/chat/completions
2024-05-10 09:41:21.943 +02:00 [INF] Received HTTP response headers after 1415.0936ms - 200
2024-05-10 09:41:21.943 +02:00 [INF] End processing HTTP request after 1415.6254ms - 200
2024-05-10 09:41:21.944 +02:00 [INF] API call duration: "00:00:01.4188096"
2024-05-10 09:41:21.950 +02:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?', @p4='?', @p5='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Requests" ("ConversationId", "CustomSystemPrompt", "Model", "Request", "RequestPrompt", "TimeStamp")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING "RequestId";
2024-05-10 09:41:21.953 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'minitronapi.Data.minitronContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-05-10 09:41:21.974 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 1463.8738ms
2024-05-10 09:41:21.975 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:41:21.975 +02:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23503: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23503
    MessageText: insert or update on table "Requests" violates foreign key constraint "FK_Requests_Conversations_ConversationId"
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Requests
    ConstraintName: FK_Requests_Conversations_ConversationId
    File: ri_triggers.c
    Line: 2608
    Routine: ri_ReportViolation
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at minitronapi.Services.ConversationService.SaveRequestToDatabase(RequestModel request)
   at minitronapi.Controllers.ChatController.SendMessage(SendMessageRequestModel request)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:41:21.997 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 1490.119ms
2024-05-10 09:41:43.785 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:41:43.793 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 8.3934ms
2024-05-10 09:41:43.833 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:41:43.833 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.2112ms
2024-05-10 09:41:44.221 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:41:44.232 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 10.3674ms
2024-05-10 09:42:46.430 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 112
2024-05-10 09:42:46.430 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:42:46.434 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:42:46.435 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 0.9018ms
2024-05-10 09:42:46.435 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:42:46.435 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: OpenAI API key is missing.
   at minitronapi.Services.RequestService..ctor(IHttpClientFactory httpClientFactory, IConfiguration configuration)
   at ResolveService(ILEmitResolverBuilderRuntimeContext, ServiceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at lambda_method373(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:42:46.437 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 6.8522ms
2024-05-10 09:43:49.281 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:43:49.281 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 0.5982ms
2024-05-10 09:43:49.322 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:43:49.322 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.2678ms
2024-05-10 09:43:49.637 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:43:49.641 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 4.1842ms
2024-05-10 09:44:16.668 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 09:44:16.674 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 6.3733ms
2024-05-10 09:44:16.705 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 09:44:16.705 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 0.2033ms
2024-05-10 09:44:16.849 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 09:44:16.856 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 6.4247ms
2024-05-10 09:44:30.163 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - application/json 120
2024-05-10 09:44:30.164 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:44:30.169 +02:00 [INF] Route matched with {action = "SendMessage", controller = "Chat"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendMessage(minitronapi.Models.SendMessageRequestModel) on controller minitronapi.Controllers.ChatController (minitronapi).
2024-05-10 09:44:30.190 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT a."Id", a."AccessFailedCount", a."ConcurrencyStamp", a."DefaultSystemPrompt", a."Email", a."EmailConfirmed", a."FullName", a."LockoutEnabled", a."LockoutEnd", a."NormalizedEmail", a."NormalizedUserName", a."PasswordHash", a."PhoneNumber", a."PhoneNumberConfirmed", a."SecurityStamp", a."TwoFactorEnabled", a."UserName"
FROM "AspNetUsers" AS a
WHERE a."Id" = @__p_0
LIMIT 1
2024-05-10 09:44:30.193 +02:00 [INF] Start processing HTTP request POST http://192.168.90.99:5003/v1/chat/completions
2024-05-10 09:44:30.193 +02:00 [INF] Sending HTTP request POST http://192.168.90.99:5003/v1/chat/completions
2024-05-10 09:44:32.229 +02:00 [INF] Executed action minitronapi.Controllers.ChatController.SendMessage (minitronapi) in 2060.2842ms
2024-05-10 09:44:32.230 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.ChatController.SendMessage (minitronapi)'
2024-05-10 09:44:32.230 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.Net.Http.HttpRequestException: No connection could be made because the target machine actively refused it. (192.168.90.99:5003)
 ---> System.Net.Sockets.SocketException (10061): No connection could be made because the target machine actively refused it.
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource.GetResult(Int16 token)
   at System.Net.Sockets.Socket.<ConnectAsync>g__WaitForConnectWithCancellation|285_0(AwaitableSocketAsyncEventArgs saea, ValueTask connectTask, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnectionPool.ConnectToTcpHostAsync(String host, Int32 port, HttpRequestMessage initialRequest, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.ConnectAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.CreateHttp11ConnectionAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.AddHttp11ConnectionAsync(QueueItem queueItem)
   at System.Threading.Tasks.TaskCompletionSourceWithCancellation`1.WaitWithCancellationAsync(CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.DiagnosticsHandler.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.<SendCoreAsync>g__Core|5_0(HttpRequestMessage request, Boolean useAsync, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at minitronapi.Services.RequestService.SendMessage(List`1 conversation)
   at minitronapi.Controllers.ChatController.SendMessage(SendMessageRequestModel request)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-05-10 09:44:32.248 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Chat/Sendmessage - 500 null text/plain; charset=utf-8 2084.4535ms
2024-05-10 09:52:07.859 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5248/api/Auth/logout - null 0
2024-05-10 09:52:07.860 +02:00 [INF] Executing endpoint 'minitronapi.Controllers.AuthController.Logout (minitronapi)'
2024-05-10 09:52:07.864 +02:00 [INF] Route matched with {action = "Logout", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Logout() on controller minitronapi.Controllers.AuthController (minitronapi).
2024-05-10 09:52:07.866 +02:00 [INF] AuthenticationScheme: Identity.Application signed out.
2024-05-10 09:52:07.866 +02:00 [INF] User logged out at "2024-05-10T07:52:07.8653195Z"
2024-05-10 09:52:07.867 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2024-05-10 09:52:07.868 +02:00 [INF] Executed action minitronapi.Controllers.AuthController.Logout (minitronapi) in 3.863ms
2024-05-10 09:52:07.868 +02:00 [INF] Executed endpoint 'minitronapi.Controllers.AuthController.Logout (minitronapi)'
2024-05-10 09:52:07.868 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5248/api/Auth/logout - 200 null application/json; charset=utf-8 9.6294ms
2024-05-10 10:55:10.887 +02:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - null null
2024-05-10 10:55:10.888 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2024-05-10 10:55:10.888 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2024-05-10 10:55:10.889 +02:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - 405 0 null 1.9473ms
2024-05-10 10:55:20.394 +02:00 [INF] Application is shutting down...
2024-05-10 10:56:23.574 +02:00 [INF] User profile is available. Using 'C:\Users\Max Planstedt\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-05-10 10:56:24.405 +02:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 10:56:24.428 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-05-10 10:56:24.448 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 10:56:24.461 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-05-10 10:56:24.462 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-05-10 10:56:24.474 +02:00 [INF] No migrations were applied. The database is already up to date.
2024-05-10 10:56:24.616 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM "AspNetRoles" AS a)
2024-05-10 10:56:24.715 +02:00 [INF] Now listening on: http://localhost:5248
2024-05-10 10:56:24.717 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2024-05-10 10:56:24.717 +02:00 [INF] Hosting environment: Development
2024-05-10 10:56:24.717 +02:00 [INF] Content root path: D:\ReposD\minitron\minitronapi
2024-05-10 10:56:25.082 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/index.html - null null
2024-05-10 10:56:25.186 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/index.html - 200 null text/html;charset=utf-8 105.3614ms
2024-05-10 10:56:25.208 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - null null
2024-05-10 10:56:25.211 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/_framework/aspnetcore-browser-refresh.js - 200 13732 application/javascript; charset=utf-8 4.0631ms
2024-05-10 10:56:25.581 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - null null
2024-05-10 10:56:25.686 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5248/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 104.9525ms
2024-05-10 10:56:44.842 +02:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - null null
2024-05-10 10:56:44.843 +02:00 [WRN] Failed to determine the https port for redirect.
2024-05-10 10:56:44.886 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2024-05-10 10:56:44.886 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2024-05-10 10:56:44.886 +02:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - 405 0 null 44.2942ms
2024-05-10 13:37:50.723 +02:00 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - null null
2024-05-10 13:37:50.726 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2024-05-10 13:37:50.726 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2024-05-10 13:37:50.726 +02:00 [INF] Request finished HTTP/1.1 OPTIONS http://localhost:5248/api/Auth/login - 405 0 null 3.2643ms
